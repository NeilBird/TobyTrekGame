<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toby Trek - The Cat Game</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="game-container">
        <div id="start-screen" class="screen">
            <div class="hero-section">
                <div class="toby-icon">
                    <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <!-- Toby's head - white with grey/black patches -->
                        <ellipse cx="50" cy="55" rx="35" ry="30" fill="#FFFFFF" stroke="#CCCCCC" stroke-width="2"/>
                        <!-- Black patch on head -->
                        <ellipse cx="35" cy="45" rx="15" ry="12" fill="#333333" transform="rotate(-15 35 45)"/>
                        <!-- Grey patch -->
                        <ellipse cx="68" cy="60" rx="10" ry="8" fill="#888888" transform="rotate(10 68 60)"/>
                        <!-- Left ear -->
                        <polygon points="22,35 32,12 42,35" fill="#FFFFFF" stroke="#CCCCCC" stroke-width="2"/>
                        <polygon points="26,32 32,18 38,32" fill="#333333"/>
                        <polygon points="28,32 32,22 36,32" fill="#FFB6C1"/>
                        <!-- Right ear -->
                        <polygon points="58,35 68,12 78,35" fill="#FFFFFF" stroke="#CCCCCC" stroke-width="2"/>
                        <polygon points="62,32 68,18 74,32" fill="#666666"/>
                        <polygon points="64,32 68,22 72,32" fill="#FFB6C1"/>
                        <!-- Eyes with yellow/green gradient -->
                        <defs>
                            <radialGradient id="eyeGradient" cx="50%" cy="50%" r="50%">
                                <stop offset="0%" style="stop-color:#9ACD32" />
                                <stop offset="50%" style="stop-color:#7CB342" />
                                <stop offset="100%" style="stop-color:#558B2F" />
                            </radialGradient>
                        </defs>
                        <ellipse cx="38" cy="55" rx="7" ry="8" fill="url(#eyeGradient)"/>
                        <ellipse cx="62" cy="55" rx="7" ry="8" fill="url(#eyeGradient)"/>
                        <ellipse cx="38" cy="56" rx="2" ry="5" fill="#000000"/>
                        <ellipse cx="62" cy="56" rx="2" ry="5" fill="#000000"/>
                        <circle cx="36" cy="52" r="2" fill="#FFFFFF"/>
                        <circle cx="60" cy="52" r="2" fill="#FFFFFF"/>
                        <!-- Nose -->
                        <polygon points="50,65 46,72 54,72" fill="#FF69B4"/>
                        <!-- Mouth -->
                        <path d="M42,78 Q50,85 58,78" stroke="#333" stroke-width="2" fill="none"/>
                        <!-- Whiskers -->
                        <line x1="30" y1="68" x2="8" y2="62" stroke="#555" stroke-width="1.5"/>
                        <line x1="30" y1="72" x2="8" y2="72" stroke="#555" stroke-width="1.5"/>
                        <line x1="30" y1="76" x2="8" y2="82" stroke="#555" stroke-width="1.5"/>
                        <line x1="70" y1="68" x2="92" y2="62" stroke="#555" stroke-width="1.5"/>
                        <line x1="70" y1="72" x2="92" y2="72" stroke="#555" stroke-width="1.5"/>
                        <line x1="70" y1="76" x2="92" y2="82" stroke="#555" stroke-width="1.5"/>
                    </svg>
                </div>
                <h1>Toby Trek</h1>
                <div class="version-row">
                    <div class="version">v1.1.2</div>
                    <div id="total-plays" class="total-plays">ğŸ® Total plays: Loading...</div>
                </div>
            </div>
            
            <!-- Kitty Coins Display -->
            <div id="kitty-coins-display" class="kitty-coins">Kitty Coins ğŸª™ 0</div>
            
            <!-- Quick Setup Row -->
            <div class="setup-row">
                <div class="player-name-section">
                    <input type="text" id="player-name" maxlength="15" placeholder="Your name (required)" required>
                </div>
                <div class="difficulty-buttons">
                    <button class="difficulty-btn" data-difficulty="easy">Easy</button>
                    <button class="difficulty-btn active" data-difficulty="normal">Normal</button>
                    <button class="difficulty-btn" data-difficulty="hard">Hard</button>
                </div>
            </div>
            
            <!-- Main Action Buttons -->
            <div class="main-buttons">
                <button id="start-btn" class="game-btn primary">â–¶ Play</button>
                <button id="daily-challenge-btn" class="game-btn secondary">ğŸ“… Daily Challenge</button>
            </div>
            
            <!-- Bottom Row: Quick Actions -->
            <div class="quick-actions">
                <button id="how-to-play-btn" class="action-btn">â“ How to Play</button>
                <button id="achievements-btn" class="action-btn">ğŸ† Achievements</button>
                <button id="skins-btn" class="action-btn">ğŸ›’ Pet Shop</button>
                <button id="stats-btn" class="action-btn" onclick="showStats()">ğŸ“Š Stats</button>
            </div>
            
            <!-- Settings Icons -->
            <div class="settings-bar">
                <button id="sound-toggle" class="settings-btn" title="Toggle Sound">ğŸ”Š</button>
                <button id="music-toggle" class="settings-btn" title="Toggle Music">ğŸµ</button>
            </div>
            
            <!-- Collapsible How to Play Panel -->
            <div id="how-to-play-panel" class="panel hidden">
                <div class="panel-header">
                    <h3>How to Play</h3>
                    <button class="close-panel-btn" onclick="togglePanel('how-to-play-panel')">âœ•</button>
                </div>
                <div class="panel-content">
                    <p><span class="key">â†</span> <span class="key">â†’</span> move | <span class="key">SPACE</span> punch (boss) | <span class="key">P</span> pause</p>
                    <p class="mobile-hint">ğŸ“± Mobile: Use buttons to move! ğŸ‘Š Punch bosses!</p>
                    <div class="legend">
                        <div class="legend-item good"><span class="icon">ğŸ— ğŸ¥«</span> Treats = Energy!</div>
                        <div class="legend-item bad"><span class="icon">ğŸ’¨ ğŸ’§</span> Hazards = Avoid!</div>
                        <div class="legend-item power"><span class="icon">ğŸ›¡ï¸âš¡ğŸ§²âœ¨ğŸ‘Š</span> Power-ups!</div>
                    </div>
                    <p class="worlds">ğŸŒ¿ Garden â†’ â„ï¸ Snow â†’ ğŸ¢ Park â†’ ğŸš€ Space â†’ ğŸ˜¼ BOSS every 6 levels!</p>
                    <p class="difficulty-info">ğŸ“Š Score Multiplier: Easy 0.5x | Normal 1x | Hard 2x</p>
                </div>
            </div>
            
            <!-- Collapsible Shop Panel -->
            <div id="skins-panel" class="panel shop-panel hidden">
                <div class="panel-header">
                    <h3>ğŸ›’ Pet Shop</h3>
                    <button class="close-panel-btn" onclick="togglePanel('skins-panel')">âœ•</button>
                </div>
                <div class="panel-content">
                    <!-- Shop Category Tabs -->
                    <div class="shop-tabs">
                        <button class="shop-tab active" data-category="skins" onclick="switchShopCategory('skins')">ğŸ± Skins</button>
                        <button class="shop-tab" data-category="accessories" onclick="switchShopCategory('accessories')">ğŸ€ Accessories</button>
                        <button class="shop-tab" data-category="powerups" onclick="switchShopCategory('powerups')">âš¡ Power-ups</button>
                    </div>
                    
                    <p class="shop-info">Earn ğŸª™ Kitty Coins by collecting treats, completing levels, and defeating bosses!</p>
                    
                    <!-- Sort Options -->
                    <div class="shop-sort">
                        <label>Sort by:</label>
                        <select id="shop-sort-select" onchange="sortShopItems()">
                            <option value="default">Default</option>
                            <option value="price-low">Price: Low to High</option>
                            <option value="price-high">Price: High to Low</option>
                            <option value="name">Name A-Z</option>
                        </select>
                    </div>
                    
                    <!-- Shop Items Container -->
                    <div id="skin-selector" class="skin-selector"></div>
                    <div id="accessories-selector" class="skin-selector hidden"></div>
                    <div id="powerups-selector" class="skin-selector hidden"></div>
                </div>
            </div>
            
            <!-- Leaderboard (always visible but compact) -->
            <div class="leaderboard">
                <h3>ğŸ† Top Scores</h3>
                <div id="leaderboard-list">
                    <p class="no-scores">No scores yet - be the first!</p>
                </div>
            </div>
        </div>
        
        <!-- Achievements Modal -->
        <div id="achievements-modal" class="modal hidden">
            <div class="modal-content">
                <button class="close-panel-btn modal-close-btn" onclick="hideAchievements()">âœ•</button>
                <h2>ğŸ† Achievements <span id="achievements-progress">0/16</span></h2>
                <div id="achievements-list"></div>
                <button onclick="hideAchievements()" class="game-btn">Close</button>
            </div>
        </div>

        <!-- Stats Modal -->
        <div id="stats-modal" class="modal hidden">
            <div class="modal-content">
                <button class="close-panel-btn modal-close-btn" onclick="hideStats()">âœ•</button>
                <h2>ğŸ“Š Your Statistics</h2>
                <div id="stats-content" class="stats-grid">
                    <!-- Stats populated by JS -->
                </div>
                <button onclick="hideStats()" class="game-btn">Close</button>
            </div>
        </div>

        <!-- Tutorial Overlay (shown on first play) -->
        <div id="tutorial-overlay" class="tutorial-overlay hidden">
            <div class="tutorial-content">
                <h2>ğŸ± Welcome to Toby Trek!</h2>
                <div class="tutorial-steps">
                    <div class="tutorial-step">
                        <span class="tutorial-icon">ğŸ—</span>
                        <p><strong>Collect treats</strong> to gain energy and score points!</p>
                    </div>
                    <div class="tutorial-step">
                        <span class="tutorial-icon">ğŸ’§</span>
                        <p><strong>Avoid hazards</strong> - puddles and hair dryers hurt!</p>
                    </div>
                    <div class="tutorial-step">
                        <span class="tutorial-icon">â¬…ï¸â¡ï¸</span>
                        <p><strong>Move left/right</strong> using arrow keys or touch buttons</p>
                    </div>
                    <div class="tutorial-step">
                        <span class="tutorial-icon">ğŸ‘¹</span>
                        <p><strong>Boss battles</strong> every 6 levels - throw punches with SPACE!</p>
                    </div>
                </div>
                <button id="tutorial-start-btn" class="game-btn">Let's Go! ğŸš€</button>
                <label class="tutorial-checkbox">
                    <input type="checkbox" id="dont-show-tutorial"> Don't show again
                </label>
            </div>
        </div>

        <div id="game-screen" class="screen hidden">
            <div id="hud">
                <div id="timer-display">â±ï¸ <span id="timer">00:00</span></div>
                <div id="score-display">Score: <span id="score">0</span></div>
                <div id="energy-container">
                    <span>Energy:</span>
                    <div id="energy-bar">
                        <div id="energy-fill"></div>
                    </div>
                </div>
                <div id="level-display">Level: <span id="level">1</span></div>
                <div id="punch-counter" style="display: none;">ğŸ‘Š x0</div>
                <button id="pause-btn" class="hud-btn">â¸ï¸</button>
            </div>
            <div id="speed-indicator" class="hidden">âš¡ SPEED UP! âš¡</div>
            <div id="boss-indicator" class="hidden">ğŸ˜¼ BOSS BATTLE! Press SPACE or tap ğŸ‘Š to throw! ğŸ˜¼</div>
            <canvas id="game-canvas"></canvas>
            
            <!-- Pause Overlay -->
            <div id="pause-overlay" class="pause-overlay hidden">
                <div class="pause-content">
                    <h2>â¸ï¸ PAUSED</h2>
                    <p>Press ESC or P to resume</p>
                    <button id="resume-btn" class="game-btn">Resume</button>
                </div>
            </div>
            
            <!-- Mobile Touch Controls -->
            <div id="touch-controls">
                <button id="touch-left" class="touch-btn">â—€</button>
                <button id="touch-punch" class="touch-btn punch-btn">ğŸ‘Š</button>
                <button id="touch-right" class="touch-btn">â–¶</button>
            </div>
            
            <!-- Sponsors (below game canvas) -->
            <div id="sponsors">
                Sponsors: <a href="https://www.caterpillarcatering.co.uk" target="_blank" rel="noopener">Caterpillar Catering Ltd</a> and <a href="https://beatherder.co.uk" target="_blank" rel="noopener">Beat-Herder Festival</a>
            </div>
        </div>

        <div id="game-over-screen" class="screen hidden">
            <div class="toby-icon sad">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <!-- Toby's head - white with grey/black patches -->
                    <ellipse cx="50" cy="55" rx="35" ry="30" fill="#FFFFFF" stroke="#CCCCCC" stroke-width="2"/>
                    <!-- Black patch on head -->
                    <ellipse cx="35" cy="45" rx="15" ry="12" fill="#333333" transform="rotate(-15 35 45)"/>
                    <!-- Grey patch -->
                    <ellipse cx="68" cy="60" rx="10" ry="8" fill="#888888" transform="rotate(10 68 60)"/>
                    <!-- Left ear -->
                    <polygon points="22,35 32,12 42,35" fill="#FFFFFF" stroke="#CCCCCC" stroke-width="2"/>
                    <polygon points="26,32 32,18 38,32" fill="#333333"/>
                    <polygon points="28,32 32,22 36,32" fill="#FFB6C1"/>
                    <!-- Right ear -->
                    <polygon points="58,35 68,12 78,35" fill="#FFFFFF" stroke="#CCCCCC" stroke-width="2"/>
                    <polygon points="62,32 68,18 74,32" fill="#666666"/>
                    <polygon points="64,32 68,22 72,32" fill="#FFB6C1"/>
                    <!-- Eyes - sad/tired with yellow/green color -->
                    <defs>
                        <radialGradient id="eyeGradientSad" cx="50%" cy="50%" r="50%">
                            <stop offset="0%" style="stop-color:#9ACD32" />
                            <stop offset="50%" style="stop-color:#7CB342" />
                            <stop offset="100%" style="stop-color:#558B2F" />
                        </radialGradient>
                    </defs>
                    <ellipse cx="38" cy="55" rx="7" ry="6" fill="url(#eyeGradientSad)"/>
                    <ellipse cx="62" cy="55" rx="7" ry="6" fill="url(#eyeGradientSad)"/>
                    <ellipse cx="38" cy="56" rx="2" ry="4" fill="#000000"/>
                    <ellipse cx="62" cy="56" rx="2" ry="4" fill="#000000"/>
                    <circle cx="36" cy="53" r="2" fill="#FFFFFF"/>
                    <circle cx="60" cy="53" r="2" fill="#FFFFFF"/>
                    <!-- Tired eyebrows -->
                    <line x1="32" y1="46" x2="44" y2="44" stroke="#333" stroke-width="2"/>
                    <line x1="56" y1="44" x2="68" y2="46" stroke="#333" stroke-width="2"/>
                    <!-- Nose -->
                    <polygon points="50,65 46,72 54,72" fill="#FF69B4"/>
                    <!-- Sad mouth -->
                    <path d="M42,82 Q50,76 58,82" stroke="#333" stroke-width="2" fill="none"/>
                    <!-- Whiskers -->
                    <line x1="30" y1="68" x2="8" y2="62" stroke="#555" stroke-width="1.5"/>
                    <line x1="30" y1="72" x2="8" y2="72" stroke="#555" stroke-width="1.5"/>
                    <line x1="30" y1="76" x2="8" y2="82" stroke="#555" stroke-width="1.5"/>
                    <line x1="70" y1="68" x2="92" y2="62" stroke="#555" stroke-width="1.5"/>
                    <line x1="70" y1="72" x2="92" y2="72" stroke="#555" stroke-width="1.5"/>
                    <line x1="70" y1="76" x2="92" y2="82" stroke="#555" stroke-width="1.5"/>
                </svg>
            </div>
            <h1>Game Over!</h1>
            <p id="game-over-message">Toby ran out of energy!</p>
            <div id="personal-best-display" class="personal-best"></div>
            <div id="final-stats">
                <p>â±ï¸ Time: <span id="final-time">00:00</span></p>
                <p>ğŸ† Score: <span id="final-score">0</span></p>
                <p>ğŸ“Š Level: <span id="final-level">1</span></p>
            </div>
            <div class="game-over-buttons">
                <button id="restart-btn" class="game-btn">Run Again!</button>
                <button id="share-btn" class="game-btn share-btn" onclick="shareScore()">ğŸ“¤ Share</button>
            </div>
        </div>
    </div>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- Firebase Configuration -->
    <script>
        // Firebase config for TobyTrek
        const firebaseConfig = {
            apiKey: "AIzaSyD5JpBPBtvxX5OaPYpG0EFWKY0kpirklZ8",
            authDomain: "tobytrek-c220f.firebaseapp.com",
            databaseURL: "https://tobytrek-c220f-default-rtdb.firebaseio.com",
            projectId: "tobytrek-c220f",
            storageBucket: "tobytrek-c220f.firebasestorage.app",
            messagingSenderId: "517568152614",
            appId: "1:517568152614:web:b9f58d7e1822ce225452e7"
        };
        
        // Initialize Firebase
        let firebaseApp = null;
        let firebaseDB = null;
        
        try {
            firebaseApp = firebase.initializeApp(firebaseConfig);
            firebaseDB = firebase.database();
            console.log('Firebase initialized successfully');
        } catch (error) {
            console.log('Firebase not configured - using local storage only');
        }
    </script>
    
    <!-- Service Worker Registration for Offline Support -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registered successfully');
                    })
                    .catch(function(error) {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }
    </script>
    
    <script src="game.js"></script>
</body>
</html>
